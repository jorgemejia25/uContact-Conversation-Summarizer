<div
  style="
    margin: 0;
    padding: 0;
    font-family: 'Inter', 'Segoe UI', sans-serif;
    background-color: #121212;
    color: #e0e0e0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: start;
    padding-top: 40px;
  "
>
  <div
    style="
      width: 100%;
      max-width: 900px;
      background-color: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      overflow: hidden;
    "
  >
    <!-- Tab headers -->
    <div style="display: flex; border-bottom: 1px solid #333">
      <button
        onclick="mostrarTab('llamadas')"
        id="tab-llamadas"
        style="
          flex: 1 1 0%;
          padding: 16px;
          font-size: 16px;
          font-weight: 500;
          border: none;
          background-color: rgb(30, 30, 30);
          color: rgb(136, 136, 136);
          cursor: pointer;
        "
      >
        ðŸ"ž Resumen de Llamadas
      </button>
      <button
        onclick="mostrarTab('conversaciones')"
        id="tab-conversaciones"
        style="
          flex: 1 1 0%;
          padding: 16px;
          font-size: 16px;
          font-weight: 500;
          border: none;
          background-color: rgb(39, 39, 39);
          color: rgb(224, 224, 224);
          cursor: pointer;
        "
      >
        ðŸ'¬ Resumen de Conversaciones
      </button>
    </div>

    <!-- TAB: LLAMADAS -->
    <div id="contenido-llamadas" style="display: none">
      <div style="padding: 32px 24px">
        <form id="formularioLlamadas" onsubmit="event.preventDefault();">
          <!-- N&Atilde;&ordm;mero telef&Atilde;&sup3;nico y bot&Atilde;&sup3;n de b&Atilde;&ordm;squeda -->
          <div
            style="
              margin-bottom: 32px;
              display: flex;
              gap: 16px;
              align-items: flex-end;
            "
          >
            <div style="flex: 1; position: relative">
              <label
                for="numero"
                style="
                  font-size: 12px;
                  color: #888888;
                  display: block;
                  margin-bottom: 10px;
                "
                >NUMERO TELEFONICO</label
              >
              <div
                style="
                  position: relative;
                  overflow: hidden;
                  border-radius: 4px;
                  background-color: #272727;
                "
              >
                <input
                  type="text"
                  id="numero"
                  required=""
                  placeholder="Ej. 23007500"
                  style="
                    width: 100%;
                    font-size: 16px;
                    color: #ffffff;
                    padding: 16px 16px 16px 48px;
                    border: none;
                    background-color: transparent;
                  "
                />
                <div
                  style="
                    position: absolute;
                    left: 16px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #888888;
                  "
                >
                  <i class="fas fa-phone-alt"></i>
                </div>
              </div>
            </div>
            <div>
              <button
                type="button"
                onclick="buscarFechas()"
                style="
                  background-color: #03dac6;
                  color: #000000;
                  border: none;
                  border-radius: 4px;
                  padding: 16px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  width: 48px;
                  height: 48px;
                "
              >
                Buscar
              </button>
            </div>
          </div>

          <!-- Selector de fechas -->
          <div style="margin-bottom: 24px">
            <label
              for="fechaSelect"
              style="
                font-size: 12px;
                color: #888888;
                display: block;
                margin-bottom: 10px;
              "
              >FECHA</label
            >
            <select
              id="fechaSelect"
              onchange="cargarHoras()"
              required=""
              style="
                width: 100%;
                font-size: 16px;
                color: #ffffff;
                padding: 16px;
                background-color: #272727;
                border: none;
                border-radius: 4px;
              "
            >
              <option value="">-- Selecciona una fecha --</option>
            </select>
          </div>

          <!-- Selector de horas -->
          <div style="margin-bottom: 24px">
            <label
              for="horaSelect"
              style="
                font-size: 12px;
                color: #888888;
                display: block;
                margin-bottom: 10px;
              "
              >HORA</label
            >
            <select
              id="horaSelect"
              onchange="mostrarBotonTranscribir()"
              required=""
              style="
                width: 100%;
                font-size: 16px;
                color: #ffffff;
                padding: 16px;
                background-color: #272727;
                border: none;
                border-radius: 4px;
              "
            >
              <option value="">-- Selecciona una hora --</option>
            </select>
          </div>

          <!-- Bot&Atilde;&sup3;n de transcribir -->
          <div id="transcribirWrapper" style="display: none">
            <button
              type="button"
              onclick="transcribirLlamada()"
              style="
                background-color: #03dac6;
                color: #000000;
                border: none;
                border-radius: 30px;
                padding: 16px 32px;
                font-size: 15px;
                font-weight: 500;
                cursor: pointer;
                width: 100%;
              "
            >
              Transcribir llamada
            </button>
          </div>
        </form>

        <!-- Resultado -->
        <div
          id="resultadoTranscripcion"
          style="
            margin-top: 32px;
            color: #ccc;
            font-size: 15px;
            line-height: 1.6;
          "
        ></div>
      </div>
    </div>

    <!-- TAB: CONVERSACIONES -->
    <div id="contenido-conversaciones" style="display: block; padding: 24px">
      <div style="padding: 32px 24px">
        <form id="formConversaciones" onsubmit="consultarConversacion(event)">
          <div style="margin-bottom: 24px">
            <label for="numeroChat" style="font-size: 13px; color: #aaa"
              >Numero telefonico</label
            >
            <input
              type="text"
              id="numeroChat"
              required=""
              placeholder="Ej. 50212345678"
              style="
                width: 100%;
                padding: 12px 16px;
                background-color: #272727;
                border: none;
                border-radius: 6px;
                color: #fff;
                font-size: 15px;
              "
            />
          </div>

          <div style="margin-bottom: 24px">
            <label for="fechaChat" style="font-size: 13px; color: #aaa"
              >Fecha</label
            >
            <input
              type="date"
              id="fechaChat"
              required=""
              style="
                width: 100%;
                padding: 12px 16px;
                background-color: #272727;
                border: none;
                border-radius: 6px;
                color: #fff;
                font-size: 15px;
              "
            />
          </div>

          <button
            type="submit"
            style="
              width: 100%;
              padding: 14px;
              background-color: #03dac6;
              color: #000;
              font-weight: bold;
              font-size: 16px;
              border: none;
              border-radius: 30px;
              cursor: pointer;
            "
          >
            Consultar ConversaciÃ³n
          </button>
        </form>

        <div
          id="resultadoConversacion"
          style="
            margin-top: 32px;
            color: #ccc;
            font-size: 15px;
            line-height: 1.6;
          "
        ></div>
      </div>
    </div>
  </div>
</div>

<script>
  function mostrarTab(tab) {
    const tabs = ["llamadas", "conversaciones"];
    tabs.forEach((t) => {
      document.getElementById(`contenido-${t}`).style.display =
        t === tab ? "block" : "none";
      document.getElementById(`tab-${t}`).style.backgroundColor =
        t === tab ? "#272727" : "#1e1e1e";
      document.getElementById(`tab-${t}`).style.color =
        t === tab ? "#e0e0e0" : "#888";
    });
  }

  // Simulaci&Atilde;&sup3;n de resultado de conversaci&Atilde;&sup3;n
  document
    .getElementById("formConversaciones")
    .addEventListener("submit", function (e) {
      e.preventDefault();
      const numero = document.getElementById("numeroChat").value;
      const fecha = document.getElementById("fechaChat").value;
      document.getElementById("resultadoConversacion").innerHTML = `
      <p><strong>N&Atilde;&ordm;mero:</strong> ${numero}</p>
      <p><strong>Fecha:</strong> ${new Date(fecha).toLocaleDateString()}</p>
      <p>&eth;&#159;&sect;&nbsp; <em>Resumen de conversaci&Atilde;&sup3;n:</em> El cliente solicit&Atilde;&sup3; informaci&Atilde;&sup3;n sobre horarios de atenci&Atilde;&sup3;n. Se le brind&Atilde;&sup3; la informaci&Atilde;&sup3;n correctamente y finaliz&Atilde;&sup3; agradeciendo.</p>
    `;
    });
</script>

<script>
  function consultarConversacion(e) {
    e.preventDefault();

    const numero = document.getElementById("numeroChat").value.trim();
    const fecha = document.getElementById("fechaChat").value;

    if (!numero || !fecha) {
      alert("Debes ingresar ambos campos.");
      return;
    }

    const url = `https://oradepoc.ucontactcloud.com/api/api/db/chat/summary?callerId=${numero}&date=${fecha}`;

    fetch(url)
      .then((res) => res.json())
      .then((data) => {
        const resumen =
          data.summary || "No se encontro resumen para esta fecha.";
        document.getElementById("resultadoConversacion").innerHTML = `
          <h3 style="margin-bottom: 12px; color: #03dac6;">📝 Resumen de Conversacion</h3>
          <p><strong>Numero:</strong> ${numero}</p>
          <p><strong>Fecha:</strong> ${new Date(fecha).toLocaleDateString(
            "es-ES"
          )}</p>
          <p style="margin-top: 16px;">${resumen}</p>
        `;
      })
      .catch((err) => {
        document.getElementById("resultadoConversacion").innerHTML =
          "<p style='color: red;'>❌ Error al obtener el resumen.</p>";
        console.error(err);
      });
  }
</script>

<script>
  let llamadas = [];

  function buscarFechas() {
    const numero = document.getElementById("numero").value.trim();
    if (!numero) return alert("Ingrese un numero valido.");

    fetch(`https://oradepoc.ucontactcloud.com/api/api/db/calls/${numero}`)
      .then((res) => {
        if (!res.ok) {
          throw new Error("Error en la respuesta del servidor");
        }
        return res.json();
      })
      .then((data) => {
        llamadas = data;
        const fechaSelect = document.getElementById("fechaSelect");
        fechaSelect.innerHTML =
          '<option value="">-- Selecciona una fecha --</option>';

        if (data && data.length > 0) {
          data.forEach((entry) => {
            const option = document.createElement("option");
            option.value = entry.fecha;
            option.textContent = new Date(entry.fecha).toLocaleDateString(
              "es-ES"
            );
            fechaSelect.appendChild(option);
          });
        } else {
          alert("No se encontraron llamadas para este numero.");
        }

        document.getElementById("horaSelect").innerHTML =
          '<option value="">-- Selecciona una hora --</option>';
        document.getElementById("transcribirWrapper").style.display = "none";
        document.getElementById("resultadoTranscripcion").innerHTML = "";
      })
      .catch((err) => {
        alert("Error al obtener fechas: " + err.message);
        console.error(err);
      });
  }

  function cargarHoras() {
    const fecha = document.getElementById("fechaSelect").value;
    const horaSelect = document.getElementById("horaSelect");
    horaSelect.innerHTML =
      '<option value="">-- Selecciona una hora --</option>';
    document.getElementById("transcribirWrapper").style.display = "none";
    document.getElementById("resultadoTranscripcion").innerHTML = "";

    const seleccion = llamadas.find((item) => item.fecha === fecha);
    if (seleccion && seleccion.horas && seleccion.guids) {
      const horas = seleccion.horas.split(", ");
      const guids = seleccion.guids.split(", ");
      const duraciones = seleccion.duraciones.split(", ");

      horas.forEach((hora, index) => {
        const option = document.createElement("option");
        option.value = guids[index].trim(); // Guardamos el GUID como valor
        option.textContent = `${hora} (${duraciones[index]} seg)`;
        horaSelect.appendChild(option);
      });
    }
  }

  function mostrarBotonTranscribir() {
    const fecha = document.getElementById("fechaSelect").value;
    const guid = document.getElementById("horaSelect").value;
    const visible = fecha && guid;
    document.getElementById("transcribirWrapper").style.display = visible
      ? "block"
      : "none";
    document.getElementById("resultadoTranscripcion").innerHTML = "";
  }

  function transcribirLlamada() {
    const guid = document.getElementById("horaSelect").value;
    const fecha = document.getElementById("fechaSelect").value;

    if (!guid) {
      alert("Por favor seleccione una llamada.");
      return;
    }

    // Mostrar indicador de carga
    document.getElementById("resultadoTranscripcion").innerHTML = `
      <div style="text-align: center; padding: 20px;">
        <p>Procesando transcripcion...</p>
      </div>
    `;

    const url = `https://oradepoc.ucontactcloud.com/api/api/db/calls/guid?guid=${encodeURIComponent(
      guid
    )}`;

    fetch(url)
      .then((res) => {
        if (!res.ok) {
          throw new Error("Error al obtener la transcripcion");
        }
        return res.json();
      })
      .then((data) => {
        const resumen =
          data.summary || "No se encontro transcripcion para esta llamada.";
        const seleccion = llamadas.find((item) => item.fecha === fecha);
        const horaIndex = seleccion.guids.split(", ").indexOf(guid);
        const hora = seleccion.horas.split(", ")[horaIndex];
        const duracion = seleccion.duraciones.split(", ")[horaIndex];

        document.getElementById("resultadoTranscripcion").innerHTML = `
          <h3 style="margin-bottom: 12px; color: #03dac6;">📝 Transcripcion de la llamada</h3>
          <p><strong>Fecha:</strong> ${new Date(fecha).toLocaleDateString(
            "es-ES"
          )}</p>
          <p><strong>Hora:</strong> ${hora}</p>
          <p><strong>Duracion:</strong> ${duracion} segundos</p>
          <div style="margin-top: 16px; padding: 16px; background-color: #272727; border-radius: 8px;">
            ${resumen}
          </div>
        `;
      })
      .catch((err) => {
        document.getElementById("resultadoTranscripcion").innerHTML = `
          <div style="color: #ff6b6b; padding: 16px; background-color: #272727; border-radius: 8px;">
            <p>❌ Error al obtener la transcripcion: ${err.message}</p>
          </div>
        `;
        console.error(err);
      });
  }
</script>
